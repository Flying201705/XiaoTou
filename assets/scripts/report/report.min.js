var report;(function(a){function o(){let ea=wx.getStorageSync("miniapp_user_account");return ea.openid?(ea.unionid=ea.unionid||"",ea):{openid:"",unionid:""}}function u(ea,fa,ga=!0,ha=Number.MAX_SAFE_INTEGER,ia=0){let ja=[],ka=[],la=0;for(let oa=0;oa<ea.length||0;oa++)if(!isNaN(ea[oa][fa])&&(ea[oa][fa]=+ea[oa][fa],!(ea[oa][fa]<=ia))){if(ea[oa][fa]>=ha){ja.push(ea[oa]);continue}ka.push(ea[oa]),la+=ea[oa][fa]}if(!la||!ka.length)return[];let ma=[];for(;ka.length;){let oa=Math.random(),pa=0;for(let ra,qa=0;qa<ka.length;qa++){if(ra=pa+ka[qa][fa]/la,oa>=pa&&oa<ra){ma.push(ka[qa]),la-=ka[qa][fa],ka.splice(qa,1);break}pa=ra}}let na=ja.concat(ma);return ga?na[0]:na}var O=!0;window.report=a;var P=0,Q,R=null,S="icon",T=!1,U=null,V=null,W=null,X=!1,Y=null,Z=null,$=null;const aa="https://xyxcck-log.raink.com.cn",ba="https://xyxcck-log-ad.raink.com.cn",ca="https://xyxcck-friend.raink.com.cn",da="https://cdn-xyx.raink.com.cn";a.stoplog=function(){O=!1},a.autoInit=function(ea,fa,ga,ha=null,ia=null){return P=ea,Q=fa,"undefined"==typeof wx?(O&&console.log("reprot::autoInit->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883"),void ha.call(ia,o())):void wx.login({success:ja=>{this.init(P,fa,ja.code,ga,ha,ia)}})},a.init=function(ea,fa,ga,ha,ia=null,ja=null){return P=ea,Q=fa,"undefined"!=typeof wx&&(R=wx.getSystemInfoSync().platform),this.loadShareInfoList(),this.loadRecommendInfoList(),"undefined"==typeof wx?(O&&console.log("reprot::init->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883"),void ia.call(ja,o())):void(O&&console.log("mpsdk","SDK\u521D\u59CB\u5316/\u542F\u52A8\u53C2\u6570",JSON.stringify(ha)),wx.getSetting({success:ka=>{if(ka.authSetting["scope.userInfo"])wx.getUserInfo({withCredentials:!0,success:la=>{let ma={code:ga,encryptedData:la.encryptedData,iv:la.iv};this.getUserData(ma,ha,ia,ja)}});else{this.getUserData({code:ga,encryptedData:"",iv:""},ha,ia,ja)}}}))},a.initWithAccount=function(ea,fa,ga,ha){P=ea,Q=fa,"undefined"!=typeof wx&&(R=wx.getSystemInfoSync().platform),O&&console.log("mpsdk","SDK\u521D\u59CB\u5316/\u542F\u52A8\u53C2\u6570",JSON.stringify(ha)),this.loadShareInfoList(),this.loadRecommendInfoList(),this.setAccount(ga);let ia=this.parseAccountSource(ha);this.setAccountSource(ia.sourceType,ia.sourceId),this.reportAppRun(ha)},a.getUserData=function(ea,fa,ga=null,ha=null){let ia=this.parseAccountSource(fa);wx.request({url:"https://xyxcck-auth.raink.com.cn"+"/MiniGame/data/getOpenId2.action",data:{gameId:P,code:ea.code,encryptedData:ea.encryptedData,iv:ea.iv,unionId:ea.encryptedData&&ea.iv?"true":"false",sourceType:ia.sourceType,sourceId:ia.sourceId},success:ja=>{O&&console.log("mpsdk","\u4E0A\u62A5\u7528\u6237\u6765\u6E90\u6210\u529F","sourceType=",ia.sourceType,"sourceId=",ia.sourceId),this.setAccount(ja.data),this.reportAppRun(fa),ga&&ga(ja.data.openid)}})},a.parseAccountSource=function(ea){let fa=null;return fa="share"==ea.query.type?{sourceType:ea.query.type,sourceId:ea.query.shareid}:"wxad"==ea.query.type?{sourceType:ea.query.type,sourceId:ea.query.adid+"."+ea.query.weixinadinfo}:ea.query.type?{sourceType:ea.query.type,sourceId:ea.query.adid}:{sourceType:"std",sourceId:ea.scene},fa},a.reportAppRun=function(ea){"share"==ea.query.type?this.reportShareIn(ea.query.shareid,ea.query.userid,ea.shareTicket,ea.query.shareinfoid||""):"wxad"==ea.query.type?this.reportAdIn(ea.query.adid,ea.query.gdt_vid,ea.query.weixinadinfo):ea.query.type&&this.reportLinkIn(ea.query.adid,ea.referrerInfo?ea.referrerInfo.appId:"")},a.loadShareInfoList=function(){return null==Y?X?void(O&&console.log("mpsdk","\u6B63\u5728\u52A0\u8F7D\u5206\u4EAB\u63A8\u8350\u914D\u7F6E\u8868,\u65E0\u9700\u91CD\u590D\u52A0\u8F7D")):void(X=!0,wx.request({url:da+"/ad/"+Q+"/share.json",success:ea=>{O&&console.log("mpsdk","\u52A0\u8F7D\u5206\u4EAB\u914D\u7F6E\u8868\u6210\u529F",ea.data),Y=ea.data,this.getShareInfo(Z,$)},fail:ea=>{O&&console.log("mpsdk","\u52A0\u8F7D\u5206\u4EAB\u914D\u7F6E\u8868\u5931\u8D25,\u8FD4\u56DEnull",ea),null==Y&&Z&&Z.call($,null)},complete:()=>{X=!1}})):void(O&&console.log("mpsdk","\u5DF2\u7ECF\u83B7\u5F97\u5206\u4EAB\u63A8\u8350\u914D\u7F6E\u8868,\u65E0\u9700\u91CD\u590D\u52A0\u8F7D"))},a.loadRecommendInfoList=function(){return null==U?T?void(O&&console.log("mpsdk","\u6B63\u5728\u52A0\u8F7D\u63A8\u8350\u914D\u7F6E\u8868,\u65E0\u9700\u91CD\u590D\u52A0\u8F7D")):void(T=!0,wx.request({url:da+"/ad/"+Q+"/advlist.json",success:ea=>{O&&console.log("mpsdk","\u52A0\u8F7D\u63A8\u8350\u914D\u7F6E\u8868\u6210\u529F",ea.data),U=this.rejustAdvList(ea.data),this.getRecommendInfo(V,W)},fail:ea=>{O&&console.log("mpsdk","\u52A0\u8F7D\u63A8\u8350\u914D\u7F6E\u8868\u5931\u8D25,\u8FD4\u56DEnull",ea),null==U&&V&&V.call(W,null)},complete:()=>{T=!1}})):void(O&&console.log("mpsdk","\u5DF2\u7ECF\u83B7\u5F97\u63A8\u8350\u914D\u7F6E\u8868,\u65E0\u9700\u91CD\u590D\u52A0\u8F7D"))},a.rejustAdvList=function(ea){var fa=[];for(let ga of ea){if(ga.platform&&ga.platform!=R)continue;else{if(2!==ga.category)continue}ga.page+=(-1==ga.page.indexOf("?")?"?":"&")+"type=link&adid="+ga.adid;let ha=this.getQueryString(ga.page,"bridge_appid"),ia=this.getQueryString(ga.page,"bridge_path");ha&&(ga.page=ia+"?"+ga.page.replace("bridge_appid="+ha,"bridge2appid="+ga.appid).replace("bridge_path="+ia,"bridge2path="+ga.page.split("?")[0]).split("?")[1],ga.appid=ha),0!=ga.ad_image.indexOf("http")&&(ga.ad_image=da+"/ad/images/"+ga.ad_image),0!=ga.icon.indexOf("http")&&(ga.icon=da+"/ad/images/"+ga.icon),fa.push(ga)}return fa},a.getQueryString=function(ea,fa){let ga=new RegExp("(\\?|&)"+fa+"=([^&]*)(&|$)"),ha=ea.match(ga);return null==ha?"":unescape(ha[2])},a.setAccount=function(ea){return ea.openid?(wx.setStorageSync("miniapp_user_account",ea),console.log("mpsdk","\u66F4\u65B0openid\u6210\u529F",ea.openid),!0):(console.error("\u8BBE\u7F6E\u7528\u6237\u5E10\u53F7\u5931\u8D25\uFF0C\u8BF7\u81F3\u5C11\u8BBE\u7F6Eopenid\uFF0Caccount=",ea),!1)},a.getAccount=o,a.getAccountSafe=function(){return new Promise((ea,fa)=>{if(this.getAccount().openid)ea(this.getAccount());else{let ga,ha;ga=setInterval(()=>{if(this.getAccount().openid)return clearInterval(ga),clearTimeout(ha),void ea(this.getAccount())},200),ha=setTimeout(()=>{clearInterval(ga),fa()},3e4)}})},a.getShareLink=function(ea,fa="",ga=""){let ha="type=share&shareid=share_"+P+"_"+ea+"&userid="+this.getAccount().openid;return ga&&(ha+="&shareinfoid="+ga),fa&&(ha+="&"+fa),console.log("mpsdk","\u751F\u6210\u5206\u4EAB\u94FE\u63A5\u6210\u529F",ha),ha},a.getRecommendInfo=function(ea,fa,ga=!0){if(V=ea,W=fa,U){if(V){var ha=u(U,"table",ga);console.log("mpsdk","\u83B7\u53D6\u968F\u673A\u63A8\u8350\u6210\u529F",JSON.stringify(ha)),V.call(W,ha)}}else if(!1==T)return void this.loadRecommendInfoList()},a.getShareInfo=function(ea,fa,ga=!0,ha=null){if(Z=ea,$=fa,Y){if(Z){var ia=u(Y,"table",ga);ha&&(ia.text=ia.text.replace("{nickname}",ha)),console.log("mpsdk","\u83B7\u53D6\u968F\u673A\u5206\u4EAB\u5185\u5BB9\u6210\u529F",JSON.stringify(ia)),Z.call($,ia)}}else if(!1==X)return void this.loadShareInfoList()},a.tableAlgorithm=u,a.setAccountSource=function(ea,fa){return"undefined"==typeof wx?void(O&&console.log("reprot::setAccountSource->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ga=>{wx.request({url:ca+"/MiniFriend/data/setAccountLogin.action",data:{gameId:P,openId:ga.openid,unionId:ga.unionid,sourceType:ea,sourceId:fa},success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u7528\u6237\u6765\u6E90\u6210\u529F","sourceType=",ea,"sourceId=",fa)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5\u7528\u6237\u6765\u6E90\u5931\u8D25")})},a.setAccountInfo=function(ea){return"undefined"==typeof wx?void(O&&console.log("reprot::setAccountInfo->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(fa=>{wx.request({url:ca+"/MiniFriend/data/setAccountShow.action",data:{gameId:P,openId:fa.openid,unionId:fa.unionid,show:encodeURIComponent(JSON.stringify(ea))},success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u7528\u6237\u4FE1\u606F\u6210\u529F")}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5\u7528\u6237\u4FE1\u606F\u5931\u8D25")})},a.reportLogin=function(ea=0,fa=0,ga=0){this.getAccountSafe().then(ha=>{let ia={gameid:P,userid:ha.openid,gold:ea,level_kt:fa,level_jl:ga};wx.request({url:aa+"/MiniGameLog/log/login.action",data:ia,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5login\u4E8B\u4EF6\u6210\u529F",JSON.stringify(ia))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5login\u4E8B\u4EF6\u5931\u8D25")})},a.reportGold=function(ea,fa,ga,ha){return"undefined"==typeof wx?void(O&&console.log("reprot::reportGold->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ia=>{let ja={gameid:P,userid:ia.openid,change_gold:ea,new_gold:fa,param1:ga,reason:ha};wx.request({url:aa+"/MiniGameLog/log/gold.action",data:ja,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u91D1\u5E01\u53D8\u5316\u6210\u529F",JSON.stringify(ja))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5\u91D1\u5E01\u53D8\u5316\u5931\u8D25")})},a.reportEvent=function(ea,fa="",ga=""){return"undefined"==typeof wx?void(O&&console.log("reprot::reportEvent->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ha=>{let ia={gameid:P,userid:ha.openid,eventid:ea,param1:fa,param2:ga};wx.request({url:aa+"/MiniGameLog/log/event.action",data:ia,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u4E8B\u4EF6\u65E5\u5FD7\u6210\u529F",JSON.stringify(ia))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5\u4E8B\u4EF6\u65E5\u5FD7\u5931\u8D25")})},a.reportShareOut=function(ea,fa="",ga="",ha=""){return"undefined"==typeof wx?void(O&&console.log("reprot::reportShareOut->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ia=>{let ja={gameid:P,userid:ia.openid,share_char_id:"share_"+P+"_"+ea,share_pic_id:ga,sing_or_group:ha,param1:fa};wx.request({url:aa+"/MiniGameLog/log/shareOut.action",data:ja,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5shareOut\u4E8B\u4EF6\u6210\u529F",JSON.stringify(ja))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5shareOut\u4E8B\u4EF6\u5931\u8D25")})},a.reportShareIn=function(ea,fa,ga,ha=""){return"undefined"==typeof wx?void(O&&console.log("reprot::reportShareIn->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ia=>{let ja={gameid:P,userid:ia.openid,from_share_id:ea,from_sing_or_group:ga?1:0,from_share_userid:fa,param1:ha};wx.request({url:aa+"/MiniGameLog/log/shareIn.action",data:ja,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5shareIn\u4E8B\u4EF6",JSON.stringify(ja))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5shareIn\u4E8B\u4EF6\u5931\u8D25")})},a.reportLinkIn=function(ea,fa,ga=""){return"undefined"==typeof wx?void(O&&console.log("reprot::reportLinkIn->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ha=>{let ia={gameid:P,userid:ha.openid,my_adid:ea,from_appid:fa,param1:ga};wx.request({url:ba+"/MiniGameLog/log/linkIn.action",data:ia,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5linkIn\u4E8B\u4EF6",JSON.stringify(ia))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5linkIn\u4E8B\u4EF6\u5931\u8D25")})},a.reportAdIn=function(ea,fa,ga,ha=""){return"undefined"==typeof wx?void(O&&console.log("reprot::reportAdIn->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ia=>{let ja={gameid:P,userid:ia.openid,my_adid:ea,gdt_vid:fa,weixinadinfo:ga,param1:ha};wx.request({url:ba+"/MiniGameLog/log/wxadIn.action",data:ja,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5adIn\u4E8B\u4EF6",JSON.stringify(ja))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5adIn\u4E8B\u4EF6\u5931\u8D25")})},a.rankUpload=function(ea,fa,ga){return"undefined"==typeof wx?void(O&&console.log("reprot::rankUpload->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void(!ea||void 0==fa||null==fa||this.getAccountSafe().then(ha=>{let ia={gameId:P,openId:ha.openid,unionId:ha.unionid,show:ga,dataKey:ea,dataValue:fa};wx.request({url:ca+"/MiniFriend/data/setData.action",data:ia,success:()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u6392\u884C\u699C\u6570\u636E\u6210\u529F",JSON.stringify(ia))}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u4E0A\u62A5\u6392\u884C\u699C\u6570\u636E\u5931\u8D25")}))},a.friendBind=function(ea){return"undefined"==typeof wx?void(O&&console.log("reprot::friendBind->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void(!ea||this.getAccountSafe().then(fa=>{wx.request({url:ca+"/MiniFriend/data/addFriend.action",data:{gameId:P,openId1:ea,unionId1:"",openId2:fa.openid,unionId2:fa.unionid},success:ga=>{O&&console.log("mpsdk","\u52A0\u597D\u53CB\u7ED3\u679C",ga.data)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u52A0\u597D\u53CB\u5931\u8D25")}))},a.friendList=function(ea,fa,ga){return"undefined"==typeof wx?void(O&&console.log("reprot::friendList->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ha=>{wx.request({url:ca+"/MiniFriend/data/getFriend.action",data:{gameId:P,openId:ha.openid,unionId:ha.unionid,dataKey:ea},success:ia=>{O&&console.log("mpsdk","\u83B7\u53D6\u597D\u53CB\u5217\u8868\u7ED3\u679C",ia),fa&&fa.call(ga,ia.data)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u83B7\u53D6\u597D\u53CB\u5217\u8868\u5931\u8D25")})},a.rankList=function(ea,fa,ga){return"undefined"==typeof wx?void(O&&console.log("reprot::rankList->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ha=>{wx.request({url:ca+"/MiniFriend/data/getWorld.action",data:{gameId:P,openId:ha.openid,unionId:ha.unionid,dataKey:ea},success:ia=>{O&&console.log("mpsdk","\u83B7\u53D6\u4E16\u754C\u6392\u884C\u7ED3\u679C",ia),fa&&fa.call(ga,ia.data)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u83B7\u53D6\u4E16\u754C\u6392\u884C\u5931\u8D25")})},a.rankListHistory=function(ea,fa,ga){return"undefined"==typeof wx?void(O&&console.log("reprot::rankListHistory->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ha=>{wx.request({url:ca+"/MiniFriend/data/getRank.action",data:{gameId:P,openId:ha.openid,unionId:ha.unionid,dataKey:ea},success:ia=>{O&&console.log("mpsdk","\u83B7\u53D6\u4E0A\u671F\u6392\u884C\u7ED3\u679C",ia),fa&&fa.call(ga,ia.data)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u83B7\u53D6\u4E0A\u671F\u6392\u884C\u5931\u8D25")})},a.joinLottery=function(ea,fa,ga){return"undefined"==typeof wx?void(O&&console.log("reprot::joinLottery->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void(!ea||!fa||this.getAccountSafe().then(ha=>{wx.request({url:ca+"/MiniFriend/data/setAccount.action",data:{gameId:P,openId:ha.openid,unionId:ha.unionid,show:ga,parameter1:ea,parameter2:fa},success:ia=>{O&&console.log("mpsdk","\u53C2\u4E0E\u62BD\u5956\u7ED3\u679C",ia)}})}).catch(()=>{O&&console.log("mpsdk","openid\u8D85\u65F6\u672A\u5C31\u7EEA\uFF0C\u53C2\u4E0E\u62BD\u5956\u5931\u8D25")}))},a.linkEvent=function(ea,fa){return"undefined"==typeof wx?void(O&&console.log("reprot::linkEvent->\u672A\u627E\u5230\u5FAE\u4FE1\u8FD0\u884C\u73AF\u5883")):void this.getAccountSafe().then(ga=>{wx.request({url:ba+"/MiniGameLog/log/linkEvent.action",data:{gameid:P,userid:ga.openid,link_to_game_id:ea,link_ad_id:fa,param1:S},success:()=>{O&&console.log("mpsdk","\u70B9\u51FB\u63A8\u8350\u4FE1\u606F\u8DF3\u8F6C\u4E0A\u62A5\u6210\u529F,type:"+S+" adid:"+fa+" aid:"+ea)}})}).catch(()=>{O&&console.log("mpsdk","\u4E0A\u62A5\u5E7F\u544A\u70B9\u51FB\u65E5\u5FD7\u5931\u8D25")})},a.getUserId=function(){if(o().openid)return o().openid;return o().unionid?o().unionid:""},a.checkOpenId=function(){return!!o().openid}})(report||(report={}));